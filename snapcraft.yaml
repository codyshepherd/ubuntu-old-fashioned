name: oldfashioned
version: git
summary: Ubuntu Old Fashioned Image Builder
description: |
  This snap is meant to let you build ubuntu cloud images locally from a
  livecd-rootfs checkout.

grade: stable
confinement: classic
architectures: [ all ]

apps:
  old-fashioned-image-build:
    command: old-fashioned-image-build

parts:
  oldfashioned:
    plugin: nil
    source: .
    source-type: git
    build-packages:
      - bzr
      - python-ubuntutools
    override-build: |
      snapcraftctl build

      sed '/OLD_FASHIONED_BUILD_CACHE/ s|=.*|="$SNAPCRAFT_PART_INSTALL"|'

      sudo add-apt-repository -y ppa:launchpad/ppa
      sudo apt-get update
      sudo apt-get install -y launchpad-buildd
    prime:
      - +old-fashioned-image-build
